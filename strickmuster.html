<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono';  }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Ein JavaScript-Strickmuster

---

# Agenda

1. Worum es geht...
2. JavaScript Sprachfeatures
3. Lo-Dash
4. Partial Application
5. Currying
6. Memoization
8. Compose
9. Put it all together

---

#Worum es geht...

Wir wollen ein Format f&uuml;r JavaScript-Dateien die:
* leicht lesbar sind
* leicht refaktorierbar sind
* leicht anpassbar
* die "dry" sind
* die deren Funktionen das Potential haben generisch einsetzbar zu sein

---

#Worum es geht...
```javascript
(function($) {

  //define generic functions here
  var myGenericFunction = function($aDiv) {
    //do something on $aDiv
  };


  $.doneEach(".ev-my-div", function ($myDiv) {

    //specify your functions here

    //and finally wire them up finally
    myGenericFunction($myDiv);

  });

}(jQuery));
```

---
class: middle, center
#JavaScript
###can not only prototypal inheritance
###it can also
#Functional Programming
### just like Java 8

---
#JavaScript Sprach-Features

* Funktionen sind "First-Class-Citizens"
* Closures
* HigherOrder Functions
---
#Funktionen "First-Class-Citizens"
```javascript
var x = function () {
  console.log("See me later");
}

setTimeout(x, 100);
```
---
#Closures
```javascript
var remember = function () {
  var value = 42;
  return function () {
    return value;
  };
};

var extract = remember();

extract(); //42
```
---
#Higher Order Functions
like "map"
```javascript
[1,2,3].map(function (value) {
  return value * value;
}); // [1,4,9]
```
---
class: middle, center
#Lo-Dash
![Default-aligned image](images/lodash.png)

---

# Partial Application

```javascript
var add = function (a, b) {
  return a + b;
}

var createAdd = function (a, b) {
  return function () {
    return add(a, b);
  };
};

var seven = createAdd(2,5); // results in a new function
seven();                    // 7
```
---

#Partial Application
```javascript
var add = function (a, b) {
  return a + b;
}

var seven = _.partial(add, 2,5); // results in a new function
seven();                         // 7
```
---

#Partial Application
```javascript
var add = function (a, b) {
  return a + b;
}

var add2= _.partial(add, 2); // results in a new function
add2(5);                     // 7
```
---
#Currying

```javascript
var get = _.curry(function (property, object) {
  return object[property];
});

var account= {
  name: "Homer Simpson",
  sum : 9
};

get("name");       //results in a new function
get("name")(account); // results in "Homer Simpson"
```
---

class: middle, center
#Jetzt mal selber probieren
###[http://jsfiddle.net/fonzerelly/en21zLxt/]

---

#_.memoize
```javascript
var createLookup = function ($parent) {
  return _.memoize(function(selector) {
    return $parent.find(selector);
  };
};

$.doneEach(".my-div", function ($myDiv) {
  var lookup = createLookup($myDiv) {
  lookup("input"); //finds all input fields in $myDiv;
  lookup("input"); //returns the same CACHED result
});
```
---

#_.memoize
###Don't use _.memoize on impure functions!!!

```javascript
var chattyAdd2 = _.memoize(function(value) {
  var result = value + 2;
  console.log(result);
  return result;
});

chattyAdd2(5) // returns 7 and logs 7
chattyAdd2(5) // only returns 7. log got omitted
```
---

class: middle, center
#Jetzt mal selber probieren
###[http://jsfiddle.net/fonzerelly/8gbypzxd/]

---
#_.compose
```javascript
var data = {
    name: "Montgomery Burns",
    account: {
      number: 0001,
      income: 900000000
    }
  };

var getIncome = _.compose(get("income"), get("account"));

getIncome(data); //900000000
```
---
#_.compose
```javascript
var data = {
    name: "Montgomery Burns",
    account: {
      number: 0001,
      income: 900000000
    }
  }

  var appendCurrency = function (income) {
         return income + "$";
      },
      getIncome = _.compose(appendCurrency, get("income"), get("account"));


getIncome(data); //900000000
```
---
class: middle, center
#Jetzt mal selber probieren
###[http://jsfiddle.net/fonzerelly/rxkq6bd8/]
---

#Plug it all together
### Remember the data structure
```javascript
//JSON-Data
var data = [
  {
    name: "Montgomery Burns",
    account: {
      number: 0001,
      income: 900000000
    }
  },
  {
    name: "Homer Simpson",
    account: {
      number: 0815,
      income: 100
    }
  }
];
```

---
#Plug it all together

```javascript
(function ($) {
  var get = _.curry(function (property, object) {
        return object[property];
      }),
      getIncome = _compose(get("account"), get("income"));
      createLineFromCustomer = function(customer) {
        var $name   = $("<div/>").text(get("name")(customer)),
            $income = $("<div/>").text(getIncome(customer);
        return $name.html() + $income.html();
      },
      insertLine = function($parent, line) {
        $parent.append(line);
      },


  $.done(".income-list", function ($incomeList) {
    var writeIncomeLine = _.partial(insertLine, $incomeList);

    _.map(data, _.compose(
      writeIncomeLine,
      createLineFromCustomer
    ));
  });
}(jQuery));
```
---
#Thanx for listening
---
# A naive Implementation of partial

```javascript
var partial = function (fn) {
  var slice = Array.prototype.slice;
  var args = slice.call(arguments, 1)
  return function () {
    var newArgs = slice.call(arguments);
    return fn.apply(null, args.concat(newArgs))
  }
};
```
---

#A naive Implementation of curry

```javascript
function curry(fn) {
  return function () {
    if (fn.length &gt; arguments.length) {
      var slice = Array.prototype.slice;
      var args = slice.apply(arguments);
      return function () {
        return fn.apply(
          null, args.concat(slice.apply(arguments))
        );
      };
    }
    return fn.apply(null, arguments);
  };
}
```

    </textarea>

    <script src="scripts/remark-latest.min.js">
    </script>
    <script>
var slideshow = remark.create({
  highlightLanguage: 'javascript',
  highlightStyle: 'railscasts'
});
    </script>
  </body>
</html>
<!--  <mindmap> -->
<!--  *wenn ich eine funktion curry was erreiche ich damit -->
<!--  * ICH ERREICHE DASS EIN PARAMETER FESTGELEGT IST -->
<!--  +HEIsst daas zwangsläufig auch, dass die funktion pure ist? Nein: -->
<!--     selbst der festgetackerte parameter kann sich dynamishc ändern wenn er ein referenz objekt ist -->
<!--  * aber ich kann annahmen über die Änderung des Parameters treffen -->
<!--    dass er sich nicht ändert... dann muss ich ihn aber auch nicht zwingend -->
<!--    currien -->
<!-- * warum curry ich nen Parameter? -->
<!--   Weil ich die Funktion in einem Kontext verwenden will, in der ich ihr -->
<!--   diesen Parameter nicht zur Verfügung stellen kann. -->
<!--  -->
<!--   get(member, obj) -->
<!--   map([objs],get("name")) -->
<!--   Was hat das nun mit dem unabhängig machen vom context zu tun? -->
<!--   &#45;> Ich kann von der Funktion via curry viele Varianten bilden, -->
<!--   die auf unterschiedliche Contexte passen. -->
<!--  -->
<!--  </mindmap> -->
<!-- *separate pure from impure &#45;> to take advantage of memoization -->

<!-- Verbesserungsvorschläge: -->
<!-- &#45; Reduce life vorführung -->
<!-- &#45; Reduce beispiel mit Sum, Beispiel mit größer werdendem Array -->
<!--  -->
<!-- &#45; Partial application life Vorführung -->
<!-- &#45; Klarstellen, dass es darauf ankommt, die Parameteranzahl auf 1 oder 0 zu bekommen, -->
<!--    so dass man die Funktionen mit map, und reduce gut verwenden kann. -->
<!--  -->
<!--    ?brauchen wir überhaupt reduce? -->
<!--  -->
<!-- &#45; Live vorführung memoize mit chatty add -->
<!--    !!! lodash wird auf der repl schnell undefined &#45; warum? !!! -->
<!--  -->
